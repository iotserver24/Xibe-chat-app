# Linux Multi-Architecture Build Guide

This guide explains the Linux multi-architecture build system and the various package formats generated by the workflow.

## Overview

The build workflow now generates Linux packages for **three architectures** in **four different formats**, providing maximum compatibility across Linux distributions and hardware platforms.

## Supported Architectures

### x64 (amd64)
- **Target**: Intel/AMD 64-bit processors
- **Common devices**: Desktop PCs, laptops, servers
- **Debian arch**: amd64
- **RPM arch**: x86_64
- **AppImage arch**: x86_64

### ARM64 (aarch64)
- **Target**: 64-bit ARM processors
- **Common devices**: Raspberry Pi 4/5 (64-bit), ARM servers, some laptops
- **Debian arch**: arm64
- **RPM arch**: aarch64
- **AppImage arch**: aarch64

### ARMv7 (armhf)
- **Target**: 32-bit ARM processors with hardware floating point
- **Common devices**: Raspberry Pi 2/3/4 (32-bit), older ARM devices
- **Debian arch**: armhf
- **RPM arch**: armv7hl
- **AppImage arch**: armhf

## Package Formats

### 1. DEB Package (.deb)
**For**: Debian, Ubuntu, Linux Mint, Pop!_OS, elementary OS, etc.

**Features:**
- âœ… System-wide installation to `/opt/xibe-chat`
- âœ… Desktop menu integration
- âœ… Icon installation
- âœ… Automatic dependency tracking
- âœ… Easy updates via `apt`

**Installation:**
```bash
# Download the appropriate architecture
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-x64-v*.deb

# Install
sudo dpkg -i xibe-chat-linux-x64-v*.deb

# If dependencies are missing
sudo apt-get install -f

# Run
xibe-chat
```

**Uninstall:**
```bash
sudo apt remove xibe-chat
```

### 2. RPM Package (.rpm)
**For**: Fedora, RHEL, CentOS, openSUSE, Mageia, etc.

**Features:**
- âœ… System-wide installation to `/opt/xibe-chat`
- âœ… Desktop menu integration
- âœ… Icon installation
- âœ… Automatic dependency tracking
- âœ… Easy updates via `dnf`/`yum`

**Installation (Fedora/RHEL):**
```bash
# Download the appropriate architecture
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-x64-v*.rpm

# Install
sudo rpm -i xibe-chat-linux-x64-v*.rpm

# Or with DNF
sudo dnf install ./xibe-chat-linux-x64-v*.rpm
```

**Installation (openSUSE):**
```bash
sudo zypper install ./xibe-chat-linux-x64-v*.rpm
```

**Uninstall:**
```bash
sudo rpm -e xibe-chat
# Or
sudo dnf remove xibe-chat
```

### 3. AppImage (.AppImage)
**For**: Any Linux distribution with FUSE support

**Features:**
- âœ… Distribution-agnostic
- âœ… No installation required
- âœ… Portable - run from anywhere
- âœ… No root access needed
- âœ… Bundles all dependencies
- âœ… No system changes

**Usage:**
```bash
# Download
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-x64-v*.AppImage

# Make executable
chmod +x xibe-chat-linux-x64-v*.AppImage

# Run
./xibe-chat-linux-x64-v*.AppImage
```

**Optional: Desktop Integration**
```bash
# AppImages can integrate themselves
./xibe-chat-linux-x64-v*.AppImage --appimage-integrate

# To remove integration
./xibe-chat-linux-x64-v*.AppImage --appimage-unintegrate
```

**Troubleshooting:**
If AppImage doesn't run, install FUSE:
```bash
# Debian/Ubuntu
sudo apt install fuse libfuse2

# Fedora
sudo dnf install fuse fuse-libs

# Arch
sudo pacman -S fuse2
```

### 4. ZIP Archive (.zip)
**For**: Manual installation, portable use, or custom deployments

**Features:**
- âœ… Portable - no installation
- âœ… Run from any location
- âœ… Multiple simultaneous versions
- âœ… No system changes
- âœ… Easy deployment to servers

**Usage:**
```bash
# Download
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-x64-v*.zip

# Extract
unzip xibe-chat-linux-x64-v*.zip -d xibe-chat

# Navigate
cd xibe-chat

# Run
./xibe_chat
```

**Create Desktop Shortcut (Optional):**
```bash
cat > ~/.local/share/applications/xibe-chat.desktop <<EOL
[Desktop Entry]
Name=Xibe Chat
Exec=/path/to/xibe-chat/xibe_chat
Icon=/path/to/xibe-chat/data/flutter_assets/logo.png
Type=Application
Categories=Network;Chat;
EOL

chmod +x ~/.local/share/applications/xibe-chat.desktop
```

## Architecture Selection Guide

### How to Check Your Architecture

```bash
# Method 1: uname
uname -m

# Outputs:
# x86_64  â†’ Download x64 packages
# aarch64 â†’ Download arm64 packages
# armv7l  â†’ Download armv7 packages

# Method 2: dpkg (Debian-based)
dpkg --print-architecture

# Method 3: rpm (RPM-based)
rpm --eval '%{_arch}'
```

### Which Architecture to Choose?

#### Desktop/Laptop PC (Intel/AMD)
- â¡ï¸ **x64** packages

#### Raspberry Pi
- **Pi 5 (64-bit OS)**: arm64
- **Pi 4 (64-bit OS)**: arm64
- **Pi 4 (32-bit OS)**: armv7
- **Pi 3 (64-bit OS)**: arm64
- **Pi 3 (32-bit OS)**: armv7
- **Pi 2**: armv7
- **Pi 1/Zero**: Not supported (ARMv6)

#### ARM Laptops/Tablets
- **Windows ARM devices**: Use Windows builds
- **Linux ARM devices**: Usually arm64

#### Servers
- **Most x86 servers**: x64
- **ARM servers**: arm64

## Distribution Recommendations

### Debian / Ubuntu / Mint
```bash
# 1. Check architecture
dpkg --print-architecture

# 2. Download DEB package for your architecture
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-{ARCH}-v*.deb

# 3. Install
sudo dpkg -i xibe-chat-linux-{ARCH}-v*.deb
sudo apt-get install -f  # Fix dependencies if needed
```

### Fedora / RHEL / CentOS
```bash
# 1. Check architecture
rpm --eval '%{_arch}'

# 2. Download RPM package for your architecture
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-{ARCH}-v*.rpm

# 3. Install
sudo dnf install ./xibe-chat-linux-{ARCH}-v*.rpm
```

### Arch / Manjaro
```bash
# AppImage is recommended for Arch-based distributions
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-{ARCH}-v*.AppImage
chmod +x xibe-chat-linux-{ARCH}-v*.AppImage
./xibe-chat-linux-{ARCH}-v*.AppImage
```

### Universal / Unknown Distribution
```bash
# Use AppImage - works on any distribution
wget https://github.com/iotserver24/xibe-chat/releases/latest/download/xibe-chat-linux-{ARCH}-v*.AppImage
chmod +x xibe-chat-linux-{ARCH}-v*.AppImage
./xibe-chat-linux-{ARCH}-v*.AppImage
```

## Build System Technical Details

### Cross-Compilation Notes

âš ï¸ **Important**: The current GitHub Actions workflow builds on x64 runners. ARM packages (arm64, armv7) are packaged from x64 builds due to GitHub Actions limitations.

**For production ARM builds**, you should:
1. Use native ARM hardware (Raspberry Pi, ARM server)
2. Or use QEMU for proper cross-compilation
3. Or use ARM-based CI runners (currently expensive)

### Current Build Process

```yaml
strategy:
  matrix:
    arch: [x64, arm64, armv7]
```

1. **x64 builds**: Native compilation on GitHub Actions x64 runners
2. **arm64/armv7 builds**: Package structure created, but binaries are x64 (limitation)

### Improving ARM Builds

To get proper ARM binaries, you can:

#### Option 1: Self-Hosted ARM Runners
```yaml
# Add to workflow
runs-on: 
  - self-hosted
  - ARM64  # or ARM32
```

#### Option 2: QEMU Cross-Compilation
```bash
# Install cross-compilation tools
sudo apt-get install qemu-user-static

# Set up binfmt
docker run --rm --privileged multiarch/qemu-user-static --reset -p yes

# Build for ARM
flutter build linux --release
```

#### Option 3: Native ARM Build
```bash
# On Raspberry Pi or ARM device
git clone <repository>
cd xibe-chat
flutter build linux --release

# Package
dpkg-deb --build deb-package xibe-chat-linux-arm64.deb
```

## Package Contents

All packages include:
- âœ… Main executable: `xibe_chat`
- âœ… Flutter libraries and dependencies
- âœ… Assets: icons, images, fonts
- âœ… Data files
- âœ… Desktop integration files

### File Structure (DEB/RPM)
```
/opt/xibe-chat/
â”œâ”€â”€ xibe_chat (executable)
â”œâ”€â”€ lib/
â”œâ”€â”€ data/
â””â”€â”€ ...

/usr/share/applications/
â””â”€â”€ xibe-chat.desktop

/usr/share/icons/hicolor/256x256/apps/
â””â”€â”€ xibe-chat.png
```

### File Structure (AppImage)
```
AppImage
â”œâ”€â”€ AppRun (launcher)
â”œâ”€â”€ xibe-chat.desktop
â”œâ”€â”€ usr/
â”‚   â”œâ”€â”€ bin/xibe_chat
â”‚   â””â”€â”€ share/
â””â”€â”€ ...
```

## Troubleshooting

### "Package architecture mismatch"
```bash
# Check your system architecture
uname -m

# Download the correct package:
# x86_64 â†’ x64
# aarch64 â†’ arm64
# armv7l â†’ armv7
```

### DEB: "Dependency problems"
```bash
# Try installing dependencies
sudo apt-get install -f

# Or manually install missing dependencies
sudo apt-get install libgtk-3-0 libstdc++6
```

### RPM: "Failed dependencies"
```bash
# Install dependencies
sudo dnf install gtk3 libstdc++

# Or force install (not recommended)
sudo rpm -i --nodeps xibe-chat-linux-*.rpm
```

### AppImage: "Permission denied"
```bash
# Make executable
chmod +x xibe-chat-linux-*.AppImage

# Check FUSE
sudo apt install fuse libfuse2  # Debian/Ubuntu
```

### AppImage: "FUSE not available"
```bash
# Extract and run without FUSE
./xibe-chat-linux-*.AppImage --appimage-extract
cd squashfs-root
./AppRun
```

### ZIP: "Error loading shared libraries"
```bash
# Install required libraries
sudo apt-get install libgtk-3-0 libstdc++6 libgcc-s1

# Check missing libraries
ldd ./xibe_chat
```

## Contributing ARM Builds

If you have access to ARM hardware and want to contribute proper ARM builds:

1. Fork the repository
2. Set up a self-hosted ARM runner
3. Modify `.github/workflows/build-release.yml` to use ARM runners
4. Test thoroughly
5. Submit a pull request

## Package Format Comparison

| Feature | DEB | RPM | AppImage | ZIP |
|---------|-----|-----|----------|-----|
| Installation Required | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Root Access Needed | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Desktop Integration | âœ… Auto | âœ… Auto | ğŸ”¶ Optional | âŒ Manual |
| System Changes | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Dependency Management | âœ… Auto | âœ… Auto | ğŸ”¶ Bundled | âŒ Manual |
| Distribution Specific | âœ… Yes | âœ… Yes | âŒ No | âŒ No |
| Portable | âŒ No | âŒ No | âœ… Yes | âœ… Yes |
| Update System | âœ… Yes | âœ… Yes | âŒ No | âŒ No |

## Recommendations

### For End Users
- **Debian/Ubuntu**: Use DEB package
- **Fedora/RHEL**: Use RPM package
- **Any Linux**: Use AppImage (easiest)
- **Portable/Testing**: Use ZIP archive

### For System Administrators
- **Servers**: DEB or RPM (easier to manage)
- **Multiple machines**: Repository-hosted DEB/RPM
- **User-space deployment**: ZIP archive
- **No admin access**: AppImage

### For Developers
- **Quick testing**: ZIP archive
- **Multiple versions**: AppImage or ZIP
- **Integration testing**: DEB/RPM in container

---

**Questions or issues?** Open an issue at https://github.com/iotserver24/xibe-chat/issues
